(function(b){b.widget("ui.spinner",{_create:function(){this.currVal=0;this._draw();this._mousewheel();this.options.showButtons!=="always"&&this.buttons.hide();this._aria()},_draw:function(){var f=this,l=f.options,c=f.element.outerWidth(),e=f.element.width()-l.buttonWidth,g=f.element.css("margin-left"),p=f.element.css("margin-right"),n=f.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(f._uiSpinnerHtml()).css({"margin-left":"0px","margin-right":"0px",width:e}).bind("keydown.spinner",
function(d){return f._keyDown(d)}).bind("keyup.spinner",function(d){return f._keyUp(d)}).bind("blur.spinner",function(){f.source=="keyboard"&&f._stop();f._readValue()}).parent().append(f._buttonHtml()).width(c).css({"margin-left":g,"margin-right":p}).hover(function(){},function(){f.source=="mouse"&&f._stop()});!b.support.opacity&&n.css("display")=="inline-block"&&b.browser.version<8&&n.css("display","inline");this.element.attr("id",function(){this.id&&n.attr("id","ui-spinner-"+this.id)});l.disabled&&
this.disable();this.buttons=n.find(".ui-spinner-button").css("width",l.buttonWidth).bind("mousedown",function(d){var h=b(this).hasClass("ui-spinner-up")?1:-1;f._stop();f.source="mouse";f._spin(h,d.shiftKey);f.options.disabled||b(this).addClass("ui-state-active");return true}).bind("mouseup",function(){f._stop();f.element.focus();b(this).removeClass("ui-state-active")}).hover(function(){f.options.disabled||b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-active ui-state-hover")});
b.browser.msie&&this.buttons.bind("dblclick",function(){b(this).trigger("mousedown").trigger("mouseup")});f.uiSpinner=n},_uiSpinnerHtml:function(){return'<span role="spinbutton" class="ui-spinner ui-widget ui-corner-all '+(this.options.spinnerClass||"")+" ui-spinner-"+this.options.dir+'"></span>'},_buttonHtml:function(){return'<a class="ui-spinner-button ui-spinner-up ui-state-default ui-corner-t'+this.options.dir.substr(-1,1)+'"><span class="ui-icon ui-icon-triangle-1-n">&#9650;</span></a><a class="ui-spinner-button ui-spinner-down ui-state-default ui-corner-b'+
this.options.dir.substr(-1,1)+'"><span class="ui-icon ui-icon-triangle-1-s">&#9660;</span></a>'},_keyDown:function(f){var l;l=f.keyCode;var c=this.options,e=b.ui.keyCode;if(this.timer)return false;if(l==e.UP||l==e.DOWN||l==e.PAGE_UP||l==e.PAGE_DOWN||l==e.RIGHT||l==e.LEFT){f=l==e.PAGE_UP||l==e.PAGE_DOWN||f.shiftKey;l=l==e.UP||l==e.PAGE_UP||l==e.RIGHT?1:-1;this.source="keyboard";this._spin(l,f);return false}else if(l==e.HOME&&!f.shiftKey&&c.max!==null){this.value(c.max);return false}else if(l==e.END&&
!f.shiftKey&&c.min!==null){this.value(c.min);return false}else if(l==e.ENTER){this._readValue();return false}else return true},_keyUp:function(){this._stop()},_spin:function(f,l){var c,e;e=this.options;var g=this;this.spinCounter=this.spinCounter||0;this.spinStage=this.spinStage||0;c=e.increments[this.spinStage];c.count&&this.spinCounter>=c.count&&this.spinStage++;c=e.increments[this.spinStage];e=e.next(this.currVal,c[l?"page":"increment"],f,e.min,e.max,e.step);if(e!==false){this.timer=setTimeout(function(){g._spin(f,
l)},c.delay);this.value(e);this.spinCounter++}},_stop:function(){if(this.timer){clearTimeout(this.timer);this.source=this.timer=this.spinCounter=this.spinStage=null;this._trigger("stop",null,{value:this.currVal})}},value:function(f,l){if(arguments.length==0)return this.currVal;else{this.currVal=f;l||this._trigger("change",null,{value:f,spinning:!!this.timer});this.element.val(this._formatted());this._aria()}},_readValue:function(){var f=this.options.parse(this.element.val());f!=this._formatted()&&
this.value(f)},_formatted:function(){var f=this.options;return f.format(this.currVal,f.precision,f.radixPoint)},_mousewheel:function(){var f=this;b.fn.mousewheel&&f.options.mouseWheel&&this.element.mousewheel(function(l,c){c=b.browser.opera?-c/Math.abs(c):c;if(!f._start(l))return false;f._spin((c>0?1:-1)*f._step(),l);f.timeout&&window.clearTimeout(f.timeout);f.timeout=window.setTimeout(function(){if(f.spinning){f._stop(l);f._change(l)}},400);l.preventDefault()})},_aria:function(){var f=this.options;
this.uiSpinner&&this.uiSpinner.attr("aria-valuemin",f.format(f.min)).attr("aria-valuemax",f.format(f.max)).attr("aria-valuenow",this._formatted())},destroy:function(){b.fn.mousewheel&&this.element.unmousewheel();this.element.removeClass("ui-spinner-input").removeAttr("disabled").removeAttr("autocomplete").removeData("spinner").unbind(".spinner");if(this.uiSpinner)if(this.uiSpinner.parent()[0]!=null)this.uiSpinner.replaceWith(this.element);else return this.element.clone(true)},enable:function(){this.element.removeAttr("disabled").siblings().removeAttr("disabled").parent().removeClass("ui-spinner-disabled ui-state-disabled");
this.options.disabled=false},disable:function(){this.element.attr("disabled",true).siblings().attr("disabled",true).parent().addClass("ui-spinner-disabled ui-state-disabled");this.options.disabled=true}});b.extend(b.ui.spinner.prototype,{version:"@VERSION",eventPrefix:"spin",options:{initValue:0,defaultValue:0,precision:0,radixPoint:".",min:null,max:null,dir:"ltr",step:1,showButtons:"always",buttonWidth:16,increments:[{count:2,increment:1,page:10,delay:500},{count:50,increment:1,page:10,delay:50},
{count:null,increment:10,page:50,delay:50}],format:function(f,l,c){return f.toFixed(l).replace(".",c)},parse:function(f){return parseFloat(f)},next:function(f,l,c,e,g,p){return c>0&&f==g||c<0&&f==e?false:Math.max(e,Math.min(g,f+l*p*c))}}})})(jQuery);if(!this.JSON)this.JSON={};
(function(){function b(h){return h<10?"0"+h:h}function f(h){e.lastIndex=0;return e.test(h)?'"'+h.replace(e,function(o){var j=n[o];return typeof j==="string"?j:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function l(h,o){var j,q,r,v,a=g,k,m=o[h];if(m&&typeof m==="object"&&typeof m.toJSON==="function")m=m.toJSON(h);if(typeof d==="function")m=d.call(o,h,m);switch(typeof m){case "string":return f(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";g+=p;k=[];if(Object.prototype.toString.apply(m)==="[object Array]"){v=m.length;for(j=0;j<v;j+=1)k[j]=l(j,m)||"null";r=k.length===0?"[]":g?"[\n"+g+k.join(",\n"+g)+"\n"+a+"]":"["+k.join(",")+"]";g=a;return r}if(d&&typeof d==="object"){v=d.length;for(j=0;j<v;j+=1){q=d[j];if(typeof q==="string")if(r=l(q,m))k.push(f(q)+(g?": ":":")+r)}}else for(q in m)if(Object.hasOwnProperty.call(m,q))if(r=l(q,m))k.push(f(q)+(g?": ":":")+r);r=k.length===0?"{}":g?"{\n"+g+k.join(",\n"+g)+
"\n"+a+"}":"{"+k.join(",")+"}";g=a;return r}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,p,n={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},d;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,o,j){var q;p=g="";if(typeof j==="number")for(q=0;q<j;q+=1)p+=" ";else if(typeof j==="string")p=j;if((d=o)&&typeof o!=="function"&&(typeof o!=="object"||typeof o.length!=="number"))throw new Error("JSON.stringify");return l("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,o){function j(r,v){var a,k,m=r[v];if(m&&typeof m==="object")for(a in m)if(Object.hasOwnProperty.call(m,a)){k=j(m,a);if(k!==undefined)m[a]=k;else delete m[a]}return o.call(r,v,m)}var q;h=String(h);c.lastIndex=0;if(c.test(h))h=h.replace(c,function(r){return"\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){q=eval("("+h+")");return typeof o==="function"?j({"":q},""):q}throw new SyntaxError("JSON.parse");}})();
(function(b){var f,l,c,e,g,p,n,d,h,o,j,q,r,v;g=b.Colour=function(a){if(!(this instanceof g))return new g(a);if(!a)throw"Invalid colour specification";if(a instanceof g){this.hsl=a.hsl;this.rgb=a.rgb}else if(a.h!==undefined&&a.s!==undefined&&a.l!==undefined)this.hsl=a;else if(typeof a=="string"){this.rgb=f(a)||j(a)||f(g.swatches[a.toLowerCase()]);if(!this.rgb){this.hsl=q(a);if(!this.hsl)throw"Invalid colour specification";}}else if(a.r!==undefined&&a.g!==undefined&&a.b!==undefined)this.rgb=a};g.prototype=
{_makeRGB:function(){if(typeof this.rgb=="undefined")this.rgb=e(this.hsl)},_makeHSL:function(){if(typeof this.hsl=="undefined")this.hsl=c(this.rgb)},luma:function(){this._makeRGB();return(0.3*this.rgb.r+0.59*this.rgb.g+0.11*this.rgb.b)/255},red:function(a){this._makeRGB();return typeof a=="undefined"?this.rgb.r:new g({r:parseInt(a,10),g:this.rgb.g,b:this.rgb.b,a:this.rgb.a})},green:function(a){this._makeRGB();return typeof a=="undefined"?this.rgb.g:new g({r:this.rgb.r,g:parseInt(a,10),b:this.rgb.b,
a:this.rgb.a})},blue:function(a){this._makeRGB();return typeof a=="undefined"?this.rgb.b:new g({r:this.rgb.r,g:this.rgb.g,b:parseInt(a,10),a:this.rgb.a})},hue:function(a){this._makeHSL();return typeof a=="undefined"?this.hsl.h:new g({h:parseFloat(a),s:this.hsl.s,l:this.hsl.l,a:this.hsl.a})},saturation:function(a){this._makeHSL();return typeof a=="undefined"?this.hsl.s:new g({h:this.hsl.h,s:parseFloat(a),l:this.hsl.l,a:this.hsl.a})},lightness:function(a){this._makeHSL();return typeof a=="undefined"?
this.hsl.l:new g({h:this.hsl.h,s:this.hsl.s,l:parseFloat(a),a:this.hsl.a})},alpha:function(a){if(arguments.length===0)return(this.hsl||this.rgb).a;else{a=a===null||a===undefined?undefined:parseFloat(a);return this.hsl?new g({h:this.hsl.h,s:this.hsl.s,l:this.hsl.l,a:a}):new g({r:this.rgb.r,g:this.rgb.g,b:this.rgb.b,a:a})}},lighten:function(a){this._makeHSL();return new g({h:this.hsl.h,s:this.hsl.s,l:this.hsl.l+(1-this.hsl.l)*a,a:this.hsl.a})},darken:function(a){this._makeHSL();return new g({h:this.hsl.h,
s:this.hsl.s,l:this.hsl.l*(1-a),a:this.hsl.a})},invert:function(){this._makeRGB();return new g({r:255-this.rgb.r,g:255-this.rgb.g,b:255-this.rgb.b,a:this.rgb.a})},complement:function(){this._makeHSL();return new g({h:(this.hsl.h+0.5)%1,s:this.hsl.s,l:this.hsl.l,a:this.hsl.a})},desaturate:function(){this._makeHSL();return new g({h:this.hsl.h,s:0,l:this.hsl.l,a:this.hsl.a})},contrast:function(a,k){return new g(this.luma()>0.6?k||"#111":a||"#eee")},analagous:function(){return[this,this.hue(this.hue()-
1/12),this.hue(this.hue()+1/12)]},tetrad:function(){return[this,this.hue(this.hue()+0.25),this.hue(this.hue()+0.5),this.hue(this.hue()+0.75)]},rectTetrad:function(){return[this,this.hue(this.hue()+1/6),this.hue(this.hue()+0.5),this.hue(this.hue()+4/6)]},triad:function(){return[this,this.hue(this.hue()-1/3),this.hue(this.hue()+1/3)]},splitComplementary:function(){return[this,this.hue(this.hue()-5/12),this.hue(this.hue()+5/12)]},toString:function(){return this.toHexString()},toHexString:function(){this._makeRGB();
return l(this.rgb)},toRGBString:function(){this._makeRGB();return r(this.rgb)},toHSLString:function(){this._makeHSL();return v(this.hsl)}};o=function(a){if(a.length==1)a+=a;return Math.max(0,Math.min(255,parseInt(a,16)))};p=function(a){var k=a.charAt(a.length-1)=="%";if(k)a=a.slice(0,a.length-1);return Math.max(0,Math.min(255,Math.round(parseInt(a,10)*(k?2.55:1))))};n=function(a){return a?Math.max(0,Math.min(1,parseFloat(a))):undefined};h=function(a){a=parseInt(a,10)%360;if(a<0)a+=360;return a/360};
d=function(a){return Math.max(0,Math.min(100,parseInt(a,10)))/100};f=g.hexToRGB=function(a){return(a=/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i.exec(a)||/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i.exec(a))?{r:o(a[1]),g:o(a[2]),b:o(a[3]),a:typeof a[4]=="undefined"||a[4]==""?undefined:o(a[4])/255}:undefined};j=g.cssRGBToRGB=function(a){return(a=/^rgba?\(\s*(-?\d+%?)\s*,\s*(-?\d+%?)\s*,\s*(-?\d+%?)\s*(?:,\s*(-?\d*(?:\.\d+)?)?)?\s*\)$/.exec(a))?{r:p(a[1]),g:p(a[2]),b:p(a[3]),a:n(a[4])}:undefined};
r=g.rgbToCSSRGB=function(a){return"rgb"+(a.a?"a":"")+"("+Math.round(a.r)+", "+Math.round(a.g)+", "+Math.round(a.b)+(a.a?", "+a.a.toFixed(2):"")+")"};v=g.hslToCSSHSL=function(a){return"hsl"+(a.a?"a":"")+"("+Math.round(a.h*360)+", "+Math.round(a.s*100)+"%, "+Math.round(a.l*100)+"%"+(a.a?", "+a.a.toFixed(2):"")+")"};q=g.cssHSLToHSL=function(a){return(a=/^hsla?\(\s*(-?\d+)\s*,\s*(-?\d+%)\s*,\s*(-?\d+%)\s*(?:,\s*(-?\d*(?:\.\d+)?)?)?\s*\)$/.exec(a))?{h:h(a[1]),s:d(a[2]),l:d(a[3]),a:n(a[4])}:undefined};
l=g.rgbToHex=function(a){var k="#"+(a.r<16?"0":"")+a.r.toString(16)+(a.g<16?"0":"")+a.g.toString(16)+(a.b<16?"0":"")+a.b.toString(16);if(a.a!==undefined){a=Math.floor(a.a*255);k+=(a<16?"0":"")+a.toString(16)}return k};c=g.rgbToHSL=function(a){var k,m,t,u,s,y=a.r/255,x=a.g/255,w=a.b/255,z=u=0,A=0;k=Math.max(y,x,w);m=Math.min(y,x,w);A=(m+k)/2;if(A>0){z=t=k-m;if(z>0){z/=A<=0.5?k+m:2-k-m;u=(k-y)/t;s=(k-x)/t;t=(k-w)/t;u=y==k?x==m?5+t:1-s:x==k?w==m?1+u:3-t:y==m?3+s:5-u;u/=6}}return{h:u%1,s:z,l:A,a:a.a}};
e=g.hslToRGB=function(a){var k,m,t,u,s,y,x,w;w=a.h%1;k=a.s;s=a.l;if(w<0)w+=1;m=t=u=s;k=s<=0.5?s*(1+k):s+k-s*k;if(k>0){s=s+s-k;w*=6;y=Math.floor(w);x=k*((k-s)/k)*(w-y);w=s+x;x=k-x;switch(y){case 0:m=k;t=w;u=s;break;case 1:m=x;t=k;u=s;break;case 2:m=s;t=k;u=w;break;case 3:m=s;t=x;u=k;break;case 4:m=w;t=s;u=k;break;case 5:m=k;t=s;u=x;break}}return{r:Math.floor(m*255),g:Math.floor(t*255),b:Math.floor(u*255),a:a.a}};g.swatches={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",
azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",
darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",
greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",
lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",
olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}})(this);
(function(b){var f=8,l=50;b.widget("ui.colourComponent",{_create:function(){var c=this;this.element.addClass("colour-component");c.queuedUpdate=null;this.sliderDiv=b("<span/>").addClass("colour-component-slider").appendTo(this.element);this.slider=this.sliderDiv.slider({min:0,max:this.options.scale,step:this.options.step,slide:function(e,g){c.options.colourProxy.set(c.options.colourProxy[c.options.component](g.value),true)},stop:function(e,g){c.options.colourProxy.set(c.options.colourProxy[c.options.component](g.value))}}).data("slider");
this.canvas=b("<canvas/>").addClass("ui-corner-all").attr({width:255,height:20}).appendTo(this.sliderDiv);this._acquireCtx();this.handle=this.sliderDiv.find(".ui-slider-handle").append("<img src='thumb.png' class='colour-component-grippy'>");this.input=b("<input/>").appendTo(this.element);this.input.spinner({min:0,max:this.options.scale,step:this.options.step,precision:this.options.places,change:function(e,g){c.options.colourProxy.set(c.options.colourProxy[c.options.component](c.input.spinner("value")),
g.spinning)},stop:function(){c.options.colourProxy.set(c.options.colourProxy[c.options.component](c.input.spinner("value")))}});this.leftHeader=b("<h4/>").addClass("slider-label").html(this.options.title).appendTo(this.sliderDiv);this.rightHeader=b("<div/>").addClass("slider-label").addClass("slider-label-secondary").html(this.options.title).appendTo(this.sliderDiv).hide();this.shownHeader="left";this.options.colourProxy.change(function(e){c.update(e)})},_acquireCtx:function(){function c(){try{e.ctx=
e.canvas[0].getContext("2d");e.queuedUpdate&&e.update(e.queuedUpdate)}catch(p){if(g<f){typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(e.canvas.get(0));setTimeout(c,(Math.pow(2,g)-1)*l);g++}}}var e=this,g=0;c()},update:function(c){var e=c[this.options.component]();this.slider.value(e);if(this.ctx){c=this.options.getGradient(c);var g=this.ctx.createLinearGradient(0,0,255,0);for(i=0;i<c.length;i++)try{g.addColorStop(i*(1/(c.length-1)),c[i].toString())}catch(p){return}this.ctx.fillStyle=
g;this.ctx.fillRect(0,0,256,20);g=c[0].contrast().toString();c=c.slice(-1)[0].contrast().toString();this.leftHeader.css("color",g);this.rightHeader.css("color",c)}else this.queuedUpdate=c;this.input.spinner("value",e,true);e=this.handle.position().left;if(e>120&&this.shownHeader=="right"){this.rightHeader.stop(false,true).hide();this.leftHeader.stop(false,true).show();this.shownHeader="left"}if(e<120&&this.shownHeader=="left"){this.rightHeader.stop(false,true).show();this.leftHeader.stop(false,true).hide();
this.shownHeader="right"}}});b.ui.colourComponent.prototype.options={scale:255,step:1,places:0};b.widget("ui.colourComponentRGB",b.ui.colourComponent.prototype);b.ui.colourComponentRGB.prototype.options={scale:255,step:1,places:0};b.widget("ui.colourComponentHSL",b.ui.colourComponent.prototype);b.ui.colourComponentHSL.prototype.options={scale:1,step:0.01,places:2};b.widget("ui.colourSwatch",{_create:function(){var c=this;this.element.addClass("colour-swatch ui-corner-all");this.swatch=b("<div/>").addClass("colour-swatch-inner ui-corner-all").appendTo(this.element);
this.readout=b("<span class='colour-swatch-readout'/>").click(function(){return false}).appendTo(this.element);this.options.colourProxy&&this.options.colourProxy.change(function(e){c.update(e)});this.element.click(function(e){c.options.click.call(c.options,e,{element:c.element,swatch:c.swatch})})},update:function(c){this.options.colour=this.options.makeColour(c);this.swatch.css({"background-color":this.options.colour.toString()});this.readout.html(this.options.colour.toString())}});b.ui.colourSwatch.prototype.options=
{colour:new Colour("black"),makeColour:function(c){return c},click:function(){this.colourProxy&&this.colourProxy.set(this.colour)}};b.widget("ui.colourSwatchGroup",{_create:function(){var c=this;this.swatches=[];b("<h2/>").html(this.options.title).appendTo(this.element);this.options.colourProxy.change(function(e){c.update(e)});this.element.addClass("colour-swatch-group")},update:function(c,e){var g=this;if(e||this.element.is(":visible")){for(this.colours=this.options.makeColours(c);this.swatches.length<
this.colours.length;)this.swatches.push(b("<span/>").colourSwatch({click:function(){g.options.colourProxy.set(this.colour)}}).appendTo(g.element).data("colourSwatch"));for(;this.swatches.length>this.colours.length;)this.swatches.pop().element.remove();b.each(this.swatches,function(p,n){n.update(g.colours[p])})}}});b.ui.colourSwatchGroup.prototype.options={title:""}})(jQuery);
(function(b){function f(c){var e,g=this;this.colour=new Colour(c||"#000");this.updateQueued=false;this.changeCallbacks=[];this.historyCallbacks=[];this.historyList=[];for(e in Colour.prototype)Object.prototype.toString.call(Colour.prototype[e])==="[object Function]"&&function(p){g[p]=function(){return g.colour[p].apply(g.colour,arguments)}}(e)}function l(c,e){this._cookieName=c||"settings";this._days=e||100;try{this._settings=JSON.parse(this._readCookie())}catch(g){}this._settings=this._settings||
{}}f.prototype={set:function(c,e){if(e){if(!this.histColour)this.histColour=this.colour}else{this.historyList.push(this.histColour||this.colour);this.histColour=null;this._history(c)}this.colour=c;this._change()},getColour:function(){return this.colour},change:function(c){c?this.changeCallbacks.push(c):this._change()},_change:function(){var c,e=this;if(!this.updateQueued){setTimeout(function(){e.updateQueued=false;for(c=0;c<e.changeCallbacks.length;c++)e.changeCallbacks[c].call(e.colour,e.colour)},
0);this.updateQueued=true}},history:function(c){c?this.historyCallbacks.push(c):this._history()},_history:function(c){var e;for(e=0;e<this.historyCallbacks.length;e++)this.historyCallbacks[e].call(this.historyList,this.historyList,c)},toString:function(){return this.colour.toString()}};l.prototype={get:function(c,e){return this._settings[c]||e||null},set:function(c,e){this._settings[c]=e;this._createCookie(JSON.stringify(this._settings),365)},destroy:function(){this._eraseCookie();this._settings=
{}},_createCookie:function(c){var e=new Date;e.setTime(e.getTime()+this._days*24*60*60*1E3);e="; expires="+e.toGMTString();document.cookie=this._cookieName+"="+c+e+"; path=/"},_readCookie:function(){for(var c=this._cookieName+"=",e=document.cookie.split(";"),g=0;g<e.length;g++){for(var p=e[g];p.charAt(0)==" ";)p=p.substring(1,p.length);if(p.indexOf(c)==0)return p.substring(c.length,p.length)}return null},_eraseCookie:function(){createCookie(this._cookieName,"",-1)}};b.ColourProxy=f;b.Settings=l})(this);
(function(b,f){function l(d){var h;h=window.location.toString().replace(/#[^#]*$/,"");var o=[d.toHexString().substring(1)];d=p.get("palette");if(d!==null){d=d.split(",");b.each(d,function(j,q){o.push(q.substring(1))})}h=[h,"#",o.join("-")].join("");b("#share-url").attr("value",h);window.location=h}function c(){return b.map(window.location.toString().replace(/^[^#]+(#|$)/,"").split("-"),function(d){return d.length?new Colour("#"+d):null})}function e(d,h,o){if(o){var j=new Date;j.setTime(j.getTime()+
o*24*60*60*1E3);o="; expires="+j.toGMTString()}else o="";document.cookie=d+"="+h+o+"; path=/"}function g(d){d=d+"=";for(var h=document.cookie.split(";"),o=0;o<h.length;o++){for(var j=h[o];j.charAt(0)==" ";)j=j.substring(1,j.length);if(j.indexOf(d)==0)return j.substring(d.length,j.length)}return null}var p=new Settings,n;b(function(){function d(j){b("link.theme").each(function(){var q=b(this);q.hasClass(j)?q.attr("media","screen"):q.attr("media","none")});p.set("theme",j)}var h=b("[name=theme]"),o=
p.get("theme","dark-theme");o=="light-theme"?b("#select-light").attr("checked","checked"):b("#select-dark").attr("checked","checked");b("#theme-select").buttonset({text:true});h.change(function(j){d(j.target.value)});d(o)});b(function(){var d,h,o=b("#main-swatch"),j=b("#main-readout"),q=b("#history");updateQueued=false;histList=(histCookie=g("colour-history"))?histCookie.split(","):[];n=new ColourProxy(p.get("current-colour","hotpink"));j.change(function(){try{n.set((new Colour(j.val())).alpha(null))}catch(r){try{n.set((new Colour("#"+
j.val())).alpha(null))}catch(v){}}});n.history(function(r){b("<div/>").addClass("colour-history-swatch ui-corner-all").css({"background-color":r.slice(-1)[0].toString()}).prependTo(q).hide().slideDown();q.children(":gte(250)").remove()});n.history(function(r,v){e("colour-history",b.map(r,function(a){return a.toString()}).slice(-250).join(","),365);l(v)});q.delegate(".colour-history-swatch","click",function(r){n.set(Colour(b(r.target).css("background-color")))});h=[];n.historyList=b.map(histList,function(r){return Colour(r)});
for(d=histList.length;d--;)h.push("<div class='colour-history-swatch ui-corner-all' style='background-color: ",histList[d],";'/>");q.append(h.join(""));n.change(function(){o.css({"background-color":n.toString(),color:n.contrast()});j.css({"border-color":n.contrast().toString(),background:n.toString()+" none",color:n.contrast().toString()}).val(n.toString());p.set("current-colour",n.toString())})});b(function(){rSlider=b("#r-slider").colourComponentRGB({title:"Red",component:"red",getGradient:function(d){return[d.red(0),
d.red(255)]},colourProxy:n}).data("colourComponentRGB");gSlider=b("#g-slider").colourComponentRGB({title:"Green",component:"green",getGradient:function(d){return[d.green(0),d.green(255)]},colourProxy:n}).data("colourComponentRGB");bSlider=b("#b-slider").colourComponentRGB({title:"Blue",component:"blue",getGradient:function(d){return[d.blue(0),d.blue(255)]},colourProxy:n}).data("colourComponentRGB");hSlider=b("#h-slider").colourComponentHSL({title:"Hue",component:"hue",getGradient:function(d){return[d.hue(0),
d.hue(1/6),d.hue(1/3),d.hue(0.5),d.hue(2/3),d.hue(5/6),d.hue(0)]},colourProxy:n}).data("colourComponentHSL");sSlider=b("#s-slider").colourComponentHSL({title:"Saturation",component:"saturation",getGradient:function(d){return[d.saturation(0),d.saturation(1)]},colourProxy:n}).data("colourComponentHSL");lSlider=b("#l-slider").colourComponentHSL({title:"Lightness",component:"lightness",getGradient:function(d){return[d.lightness(0),d.lightness(0.5),d.lightness(1)]},colourProxy:n}).data("colourComponentHSL");
variants=b("#swatch-variants").colourSwatchGroup({makeColours:function(d){return[d,d.invert(),d.complement(),d.desaturate()]},colourProxy:n}).data("colourSwatch");analagous=b("#swatch-analagous").colourSwatchGroup({makeColours:function(d){return d.analagous()},colourProxy:n}).data("colourSwatchGroup");tetrad=b("#swatch-tetrad").colourSwatchGroup({makeColours:function(d){return d.tetrad()},colourProxy:n}).data("colourSwatchGroup");rectTerad=b("#swatch-rect-tetrad").colourSwatchGroup({makeColours:function(d){return d.rectTetrad()},
colourProxy:n}).data("colourSwatchGroup");triad=b("#swatch-triad").colourSwatchGroup({makeColours:function(d){return d.triad()},colourProxy:n}).data("colourSwatchGroup");split=b("#swatch-split").colourSwatchGroup({makeColours:function(d){return d.splitComplementary()},colourProxy:n}).data("colourSwatchGroup");shades=b("#swatch-shades").colourSwatchGroup({makeColours:function(d){return[d.darken(0.5),d.darken(0.25),d,d.lighten(0.25),d.lighten(0.5)]},colourProxy:n}).data("colourSwatchGroup");n.change()});
b(function(){var d,h=p.get("accordion");h=h?b(h).prev():0;b("#swatches").accordion({header:"> h3",autoHeight:false,fillSpace:true,active:h,changestart:function(o,j){j.newContent.colourSwatchGroup("update",n,true);p.set("accordion","#"+j.newContent.attr("id"))}});b(window).bind("resize",function(){d&&clearTimeout(d);d=setTimeout(function(){b("#swatches").accordion("resize");d=null},50)})});b(function(){function d(){var a=[];b("#palette-bag .colour-swatch").each(function(){a.push(b(this).colourSwatch("option",
"colour").toString())});p.set("palette",a.join(","));l(n)}function h(){b("#palette-bag .ui-selected").length===0?b("#delete-colour").button("disable"):b("#delete-colour").button("enable")}function o(a,k){b("<span/>").colourSwatch({click:function(m,t){n.set(this.colour);if(m.ctrlKey||m.shiftKey)t.element.toggleClass("ui-selected");else{b("#palette-bag .ui-selected").removeClass("ui-selected");t.element.addClass("ui-selected")}h()}}).colourSwatch("update",a).css("opacity",0).prependTo(v).animate({opacity:1});
k||d()}var j,q=p.get("palette"),r=c(),v=b("#palette-bag");if(r&&r.length>0){n.set(r[0],true);for(j=r.length;j-- >1;)o(r[j],true);d()}else if(q){q=q.split(",");for(j=q.length;j--;)o(new Colour(q[j]),true)}b("#save-colour").button({icons:{primary:"ui-icon-disk"}}).click(function(){o(n.getColour())});b("#palette-bag").sortable({forcePlaceholderSize:true,scroll:false,tolerance:"pointer",stop:d}).selectable({filter:".colour-swatch",unselected:h,selected:h});b("#delete-colour").button({disabled:true,icons:{primary:"ui-icon-trash"}}).click(function(){b("#palette-bag .ui-selected").remove();
d();h()})});b(function(){b("#disqus_thread").dialog({width:600,height:450,autoOpen:false,title:"Comment on The Colour Toy"});b("#help-frame").dialog({width:600,height:450,autoOpen:false,title:"Colour Toy Help",autoResize:true});b("#share-frame").dialog({width:600,height:130,autoOpen:false,title:"Save & share"});b("#save-button").button({icons:{primary:"ui-icon-star"}}).click(function(){b("#share-frame").dialog("open")});b("#help-button").button({icons:{primary:"ui-icon-info"}}).click(function(){b("#help-frame").attr("src",
"http://docs.google.com/View?id=dc4kk99z_56c7zkfhdx").dialog("open").width(590).height(440)})});b(function(){f.disqus_developer=true;var d=false;b("#discuss-button").button({icons:{primary:"ui-icon-person"}}).click(function(){if(!d){var h=document.createElement("script");h.type="text/javascript";h.async=true;h.src="http://colourtoy.disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(h);d=true}b("#disqus_thread").dialog("open")})})})(jQuery,
this);
